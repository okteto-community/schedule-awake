deploy:
  compose: docker-compose.yaml

dev:
  wakeup:
    command: bash
    workdir: /usr/src/app
    sync:
      - .:/usr/src/app

test:
  api:
    image: node:22
    context: .
    commands:
      - npm install
      - chmod +x run-test.sh
      - ./run-test.sh
  health-unit:
    image: node:22
    context: .
    caches:
      - node_modules
    commands:
      - npm install
      - OKTETO_URL=${OKTETO_URL} OKTETO_TOKEN=${OKTETO_TOKEN} API_URL=https://wakeup-${OKTETO_NAMESPACE}.${OKTETO_DOMAIN} OKTETO_NAMESPACE=${OKTETO_NAMESPACE} npm run test:unit
  
  health-integration:
    image: node:22
    context: .
    caches:
      - node_modules
    commands:
      - npm install
      - API_URL=https://wakeup-${OKTETO_NAMESPACE}.${OKTETO_DOMAIN} OKTETO_NAMESPACE=${OKTETO_NAMESPACE} npm run test:integration
